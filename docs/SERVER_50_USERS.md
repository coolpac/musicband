# Оптимальный сервер на ~50 одновременных пользователей

Учитываются: Node.js API, Socket.io, PostgreSQL, Redis, админка, Telegram Mini App, голосования, заявки, загрузка изображений. Видео не раздаётся с сервера (внешний хостинг).

---

## Один сервер (всё в Docker)

| Компонент   | Нагрузка при 50 юзерах |
|------------|-------------------------|
| Backend    | 50 WebSocket + API-запросы (пики до ~100 req/s), 1 процесс Node |
| PostgreSQL | Пул ~20–30 соединений, лёгкие запросы |
| Redis      | Сессии, rate limit, кеш голосов — 256 MB хватает |
| Frontend   | Nginx отдаёт статику — почти без нагрузки |

**Рекомендуемые характеристики VPS:**

| Параметр   | Минимум | Оптимально |
|------------|---------|------------|
| **vCPU**   | 2       | 2–4        |
| **RAM**    | 2 GB    | **4 GB**   |
| **Диск**   | 20 GB SSD | 40 GB SSD |
| **Трафик** | 1–2 TB/мес | 2–4 TB/мес |

**Почему 4 GB RAM:**  
PostgreSQL ~1 GB, Redis 256 MB, Node 512 MB–1 GB, Nginx + система ~500 MB — лучше иметь запас под пики и рост.

**Примеры тарифов (ориентир):**

- **Timeweb Cloud** — 4 GB RAM, 2 vCPU, 40 GB SSD — от ~400–600 ₽/мес  
- **Selectel** — 4 GB RAM, 2 vCPU — от ~500 ₽/мес  
- **REG.RU VPS** — 4 GB RAM — от ~400 ₽/мес  
- **DigitalOcean** — 4 GB Droplet — $24/мес  
- **Hetzner** — CX22 (4 GB, 2 vCPU) — ~€5–6/мес  

---

## Если БД вынести (managed PostgreSQL)

Тогда на сервере только: Node + Redis + Nginx.

**Сервер приложения:**

- **2 vCPU, 2 GB RAM**, 20 GB SSD — обычно достаточно для 50 юзеров.

**Managed PostgreSQL** (например, Timeweb, Selectel, AWS RDS, DigitalOcean Managed DB):

- Минимальный инстанс: 1 vCPU, 1–2 GB RAM.
- Стоимость часто от ~300–500 ₽/мес и выше.

Такой вариант удобен, если хочется бэкапы и обновления БД не трогать руками.

---

## Что проверить в конфиге под 50 юзеров

1. **Пул соединений Prisma/PostgreSQL** — не больше 20–30 (в `DATABASE_URL` или в коде пула), чтобы не открывать 50 соединений на 50 юзеров.
2. **Redis** — в `docker-compose` уже `maxmemory 256mb` — норм.
3. **Rate limit** — уже есть в проекте; при 50 юзерах лимиты обычно не режут нормальных пользователей.
4. **Лимиты Nginx** (если будете править) — `worker_connections` 1024+ достаточно.

---

## Кратко

- **Оптимально для ~50 одновременных пользователей:** VPS **4 GB RAM, 2 vCPU, 40 GB SSD**, 2+ TB трафика.
- Всё (Postgres, Redis, backend, frontend) можно держать на одном сервере в Docker, как в вашем `docker-compose`.
- Если БД вынести в managed — на приложение хватит **2 GB RAM, 2 vCPU**.

Цены и названия тарифов лучше уточнять на сайтах провайдеров — они меняются.
