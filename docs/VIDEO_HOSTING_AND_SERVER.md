# Видео: вес файлов, оптимизация и сервер

## Сколько весят ваши видео

| № | Размер (МБ) |
|---|-------------|
| 1 | 916 |
| 2 | 670,2 |
| 3 | 433,6 |
| 4 | 419,5 |
| 5 | 316,1 |
| 6 | 260,9 |
| 7 | 209,2 |
| 8 | 183,5 |
| 9 | 150,5 |
| **Итого** | **~3 559 МБ (~3,5 ГБ)** |

---

## Насколько это плохо для оптимизации

**Если отдавать эти файлы как есть с вашего сервера:**

- **Трафик:** один просмотр всех 9 роликов ≈ 3,5 ГБ на пользователя. 100 пользователей ≈ 350 ГБ трафика в месяц.
- **Скорость:** без CDN загрузка будет долгой, особенно для мобильных и удалённых пользователей.
- **Сервер:** аплоад 3,5 ГБ, хранение, раздача — нагрузка на CPU/диск/сеть; при нескольких одновременных просмотрах сервер может «лечь».
- **SEO и Core Web Vitals:** тяжёлые страницы с видео ухудшают LCP, если видео грузятся сразу.

**Вывод:** хранить и раздавать 3,5 ГБ сырого видео с одного приложения/сервера — плохо и для оптимизации, и для надёжности. Нужен отдельный подход к хранению и раздаче.

---

## Что делать: три варианта

### 1. Внешний видеохостинг (оптимально по деньгам и оптимизации)

Не хранить видео у себя, а залить на сервис и вставить плеер (iframe или ссылку).

| Сервис | Плюсы | Минусы |
|--------|--------|--------|
| **YouTube** | Бесплатно, CDN, адаптивный стриминг | Реклама, брендинг YouTube |
| **Vimeo** | Без рекламы, встраивание, приватность | Платно при большом объёме |
| **Bunny Stream** | Дёшево, CDN, API, без рекламы | Плата за хранилище и трафик |
| **Cloudflare Stream** | CDN, адаптивный стриминг | Плата за минуты просмотра |

**Рекомендация:** для промо/демо — YouTube (бесплатно) или Vimeo. Если нужен свой плеер и контроль — Bunny Stream или Cloudflare Stream.

В коде оставить только URL видео (или ID) и показывать через `<iframe>` или `<video src="...">` на внешний URL.

---

### 2. Сжатие и транскодинг (если всё же хранить у себя)

Перед заливкой уменьшить размер и привести к веб-формату:

- **Разрешение:** не выше 1080p для веба, для мобильных можно 720p.
- **Кодек:** H.264 (MP4) + при желании WebM (VP9) для современных браузеров.
- **Битрейт:** 2–5 Мбит/с для 1080p, 1–2 Мбит/с для 720p.

Пример FFmpeg (1080p, ~2.5 Мбит/с):

```bash
ffmpeg -i input.mp4 -c:v libx264 -crf 23 -preset medium -vf "scale=1920:-2" -c:a aac -b:a 128k output.mp4
```

Ориентир: из 3,5 ГБ сырого видео можно получить 0,5–1,5 ГБ после нормального сжатия — и трафик, и нагрузка на сервер станут предсказуемыми.

---

### 3. Объектное хранилище + CDN (если нужен свой хостинг)

Видео не держать на том же сервере, где крутится приложение:

- **Cloudflare R2** — хранилище без платы за исходящий трафик (есть лимиты).
- **Bunny Storage** — дёшево, интеграция с Bunny CDN.
- **AWS S3 / Backblaze B2** + Cloudflare — классическая схема.

Приложение только отдаёт ссылки на видео; раздачу ведёт CDN. Так «минимальный сервер» не тратит ресурсы на гигабайты трафика.

---

## Какой минимальный сервер, если раздавать видео с него

**Если всё-таки отдавать эти файлы напрямую со своего сервера (без CDN и без сжатия):**

| Параметр | Оценка |
|----------|--------|
| **Диск** | минимум 5–10 ГБ (3,5 ГБ видео + ОС + приложение + запас) |
| **RAM** | 2–4 ГБ (сайт + несколько одновременных стримов) |
| **CPU** | 2 vCPU (без транскодинга «на лету» хватит) |
| **Трафик** | считайте: число просмотров × ~3,5 ГБ. 50 полных просмотров ≈ 175 ГБ/мес |

Типичный недорогой VPS (4 ГБ RAM, 80 ГБ SSD, 2–4 ТБ трафика) технически может хранить и отдавать 3,5 ГБ, но:

- при 10+ одновременных просмотрах канал и диск могут стать узким местом;
- без CDN загрузка будет медленной для части пользователей;
- при превышении лимита трафика провайдер может брать доплату или резать канал.

**Минимальный разумный вариант под «всё на одном сервере»:**

- **4 ГБ RAM**, **40+ ГБ SSD**, **не менее 2 ТБ трафика в месяц**;
- обязательно сжимать видео (см. выше) и по возможности ограничить одновременные просмотры или качество.

Лучше считать этот вариант запасным, а основным — внешний видеохостинг или объектное хранилище + CDN.

---

## Краткие рекомендации

1. **Не отдавать 3,5 ГБ сырого видео** прямо с сервера приложения — это плохо для оптимизации и для стабильности.
2. **Предпочтительно:** залить видео на YouTube / Vimeo / Bunny Stream и в проекте хранить только ссылки (или ID), показывать через embed.
3. **Если нужен свой хостинг:** сжать видео (FFmpeg до 1080p/720p, разумный битрейт) и вынести файлы в объектное хранилище + CDN; сервер приложения только генерирует ссылки.
4. **Минимальный сервер** при самохостинге: 4 ГБ RAM, 40+ ГБ SSD, 2+ ТБ трафика; обязательно сжатие и по возможности CDN или лимит одновременных просмотров.

Если опишете, где именно в приложении показываются эти видео (лендинг, админка, личный кабинет), можно предложить конкретную схему хранения URL и формат ответа API под выбранный вариант (YouTube/Vimeo/Bunny/своё хранилище).
