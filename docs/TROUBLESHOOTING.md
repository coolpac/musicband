# Troubleshooting ‚Äî —Ä–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

## –û—à–∏–±–∫–∞ ¬´–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã¬ª

### –ü—Ä–∏—á–∏–Ω—ã

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è** ‚Äî –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
2. **–ë—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—â–µ–Ω** –∏–ª–∏ —É–ø–∞–ª —Å –æ—à–∏–±–∫–æ–π
3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î** ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–µ credentials –∏–ª–∏ PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω
4. **CORS-–æ—à–∏–±–∫–∞** ‚Äî —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –±—ç–∫–µ–Ω–¥—É

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
cd /opt/musicians
docker compose ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã `Up` (running).

–ï—Å–ª–∏ `musicians-backend` –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

```bash
docker compose logs backend --tail=100
```

–ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, Redis –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

–° —Å–µ—Ä–≤–µ—Ä–∞:

```bash
curl http://localhost/api/formats
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```json
{
  "success": true,
  "data": [...]
}
```

–ï—Å–ª–∏ `502 Bad Gateway` ‚Äî –±—ç–∫–µ–Ω–¥ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, —Å–º. –ª–æ–≥–∏ –≤—ã—à–µ.

–ï—Å–ª–∏ `{"success":true,"data":[]}` ‚Äî –±–∞–∑–∞ –ø—É—Å—Ç–∞—è, –Ω—É–∂–µ–Ω seed.

---

### 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
cd /opt/musicians
docker compose exec backend npm run seed
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:

```
üå± Starting database seeding...
üìã Creating formats...
‚úÖ 4 formats created
‚úÖ Seed completed successfully!
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–Ω–æ–≤–∞:

```bash
curl http://localhost/api/formats
```

–¢–µ–ø–µ—Ä—å –≤ `data` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 4 —Ñ–æ—Ä–º–∞—Ç–∞.

---

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞ (–µ—Å–ª–∏ –∑–∞–≤–∏—Å –∏–ª–∏ —É–ø–∞–ª)

```bash
docker compose restart backend
docker compose logs backend --tail=50 -f
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∏–¥–∏—Ç–µ:

```
Backend server started on port 3000
Connected to database
```

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ / Telegram Mini App

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (–µ—Å–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)

**Chrome/Edge:**  
`F12` ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Network** ‚Üí –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É  
–ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `/api/formats`

- **–°—Ç–∞—Ç—É—Å 200** + –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ ‚Üí –±–∞–∑–∞ –ø—É—Å—Ç–∞—è, –∑–∞–ø—É—Å—Ç–∏—Ç–µ seed –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **–°—Ç–∞—Ç—É—Å 502/503** ‚Üí –±—ç–∫–µ–Ω–¥ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, —Å–º. –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **–°—Ç–∞—Ç—É—Å 0 / CORS error** ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ CORS, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `FRONTEND_URL` –≤ `.env`

**Telegram Mini App:**  
–í Dev Tools Telegram (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø) –∏–ª–∏ –≤ –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∏—Ö–æ–¥—è—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å—ã.

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /opt/musicians
cat .env | grep FRONTEND_URL
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
FRONTEND_URL=https://vgulcover.ru
```

–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω HTTP, –∞ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –ø–æ HTTPS ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞ CORS-–æ—à–∏–±–∫–∞.  
–ï—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî –±—ç–∫–µ–Ω–¥ –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –∑–∞–ø—Ä–æ—Å—ã.

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`:

```bash
docker compose restart backend
```

---

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| `502 Bad Gateway` | –ë—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—â–µ–Ω | `docker compose up -d backend` |
| `Connection refused` | PostgreSQL/Redis –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã | `docker compose ps`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å healthcheck |
| `FRONTEND_URL must be set` | –ù–µ —É–∫–∞–∑–∞–Ω `FRONTEND_URL` | –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å |
| `Prisma Client not generated` | –ù–µ –∑–∞–ø—É—â–µ–Ω `prisma generate` | `docker compose exec backend npx prisma generate` |
| `Table does not exist` | –ù–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ | `docker compose exec backend npm run migrate` |
| –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ —Ñ–æ—Ä–º–∞—Ç–æ–≤ | –ë–∞–∑–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ | `docker compose exec backend npm run seed` |
| CORS error –≤ –±—Ä–∞—É–∑–µ—Ä–µ | `FRONTEND_URL` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–æ–º–µ–Ω–æ–º | –ò—Å–ø—Ä–∞–≤–∏—Ç—å `.env`, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend |

---

## –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)

–ï—Å–ª–∏ –±–∞–∑–∞ –≤ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏:

```bash
cd /opt/musicians
docker compose down
docker volume rm musicians_postgres_data
docker compose up -d postgres
# –ñ–¥—ë–º ~10 —Å–µ–∫, –ø–æ–∫–∞ PostgreSQL –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
docker compose exec backend npm run migrate
docker compose exec backend npm run seed
docker compose up -d
```

**–í–Ω–∏–º–∞–Ω–∏–µ:** —ç—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ñ–æ—Ä–º–∞—Ç—ã, –∑–∞—è–≤–∫–∏, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è).

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
docker compose logs --tail=200
```

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ `ERROR`, `ECONNREFUSED`, `timeout`, `CORS`.

---

## –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç

- [ ] –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã: `docker compose ps`
- [ ] –ë—ç–∫–µ–Ω–¥ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ –ë–î: `docker compose logs backend | grep Connected`
- [ ] API –æ—Ç–≤–µ—á–∞–µ—Ç: `curl http://localhost/api/formats`
- [ ] –ë–∞–∑–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞: seed –≤—ã–ø–æ–ª–Ω–µ–Ω, API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã
- [ ] `FRONTEND_URL` –≤ `.env` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–æ–º–µ–Ω–æ–º —Å–∞–π—Ç–∞
- [ ] Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `/api/` –Ω–∞ –±—ç–∫–µ–Ω–¥ (—Å–º. `frontend/nginx/nginx-ssl.conf` —Å—Ç—Ä–æ–∫–∞ 58)

–ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª, –ø–æ—Ä—Ç—ã, DNS.
