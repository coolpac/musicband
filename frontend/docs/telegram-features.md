# Telegram Mini App — что уже есть и что ещё полезно

## Уже подключено

- **Полноэкранный режим** — `requestFullscreen()` при старте (Bot API 8.0+).
- **Запрет закрытия свайпом по контенту** — `disableVerticalSwipes()` (Bot API 7.7+).
- **Кнопка «Назад»** — системная кнопка Telegram, привязана к `history.back()`.
- **Хаптики** — impact (кнопки), selection (выбор), notification (успех/ошибка).
- **Подтверждение закрытия** — на экране формы заявки включено `enableClosingConfirmation()`, чтобы случайно не закрыть и не потерять данные.
- **Нативные алерты** — вместо `alert()` используется `showAlert()` (в Telegram — нативный попап).

---

## Что ещё полезно использовать

### 1. **MainButton (нижняя кнопка Telegram)**  
Одна большая кнопка внизу экрана в стиле Telegram.  
**Зачем:** «Отправить заявку», «Голосовать», «Получить прайс» — без своей кнопки в интерфейсе, единый стиль с клиентом.  
**Как:** `Telegram.WebApp.MainButton` — `setText()`, `show()`, `onClick()`, `showProgress()` / `hideProgress()` при отправке.

### 2. **CloudStorage**  
Хранилище ключ–значение в облаке Telegram (до 1024 ключей на пользователя).  
**Зачем:** черновик заявки (формат, дата, часть полей), последний выбранный формат, настройки — переживут закрытие приложения.  
**Как:** `Telegram.WebApp.CloudStorage` — `setItem()`, `getItem()`, `getKeys()`, `removeItem()`.

### 3. **Тема и CSS-переменные**  
Telegram передаёт `themeParams` (bg_color, text_color, button_color и т.д.).  
**Зачем:** тёмная/светлая тема и акценты без своих настроек.  
**Как:** в стилях использовать `var(--tg-theme-bg-color)`, `var(--tg-theme-text-color)`, `var(--tg-theme-button-color)` и др. (см. [документацию](https://core.telegram.org/bots/webapps#themeparams)).

### 4. **Safe area (вырезы и островки)**  
Отступы под статус-бар, вырез, навигацию.  
**Зачем:** в полноэкранном режиме контент не заезжает под системный UI.  
**Как:** CSS `env(safe-area-inset-top)` или переменные `--tg-safe-area-inset-top`, `--tg-content-safe-area-inset-*` (Bot API 8.0+).

### 5. **Данные пользователя (initDataUnsafe)**  
В `initDataUnsafe` приходят `user` (id, first_name, last_name, username).  
**Зачем:** подставить имя/username в форму заявки (после проверки подписи на бэкенде по `initData`).

### 6. **showConfirm для важных действий**  
Нативное «ОК / Отмена» вместо своего модального окна.  
**Зачем:** подтверждение «Точно отправить?», «Выйти без сохранения?».  
**Как:** уже есть `showConfirm(message)` в `telegramWebApp.ts` — возвращает `Promise<boolean>`.

### 7. **openTelegramLink**  
Открытие ссылок вида `https://t.me/...` внутри Telegram (чат бота, канал).  
**Зачем:** кнопки «Написать в Telegram», «Наш канал» открываются в приложении, а не в браузере.

### 8. **SettingsButton**  
Пункт «Настройки» в контекстном меню мини-приложения.  
**Зачем:** переход в настройки бота или приложения без отдельной кнопки в UI.

### 9. **Viewport (высота и события)**  
`viewportHeight`, `viewportStableHeight`, событие `viewportChanged`.  
**Зачем:** фиксировать кнопки/футер по низу экрана при разной высоте и анимациях.

### 10. **Уведомления об успехе/ошибке через хаптик**  
После успешной отправки заявки/отзыва вызывать `hapticNotification('success')`, при ошибке — `hapticNotification('error')` для тактильного отклика.

---

## Приоритет внедрения

| Приоритет | Фича              | Сложность | Польза для «Музыканты»        |
|----------|--------------------|-----------|--------------------------------|
| Высокий  | MainButton         | Низкая    | Единый стиль, меньше своей верстки |
| Высокий  | CloudStorage черновик | Средняя | Не терять данные при закрытии |
| Средний  | Тема (CSS vars)    | Низкая    | Поддержка светлой темы Telegram |
| Средний  | Safe area          | Низкая    | Удобно на устройствах с вырезом |
| Средний  | initData → форма   | Средняя   | Меньше ввода для пользователя |
| По желанию | showConfirm      | Низкая    | Подтверждение отправки/выхода |
| По желанию | openTelegramLink | Низкая  | Ссылки на бота/канал в Telegram |
